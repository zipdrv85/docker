# docker-compose.yml

version: "3"

services:
  edm-app-1: # 서비스명
    #image: zipdrv/edm60:6.1.0.1 # 이미지, 태그
    build:
      context: ../edm/
      dockerfile: Dockerfile
    ports:
      - "7180:7080"
    expose:
      - "7080"
    volumes:
      - /docker/service/postEdmHA/data:/app/xedrm60/data
    env_file:
      - ../edm/edm.postgres.env
    networks:
      - backend
    depends_on:
      - db
  edm-app2-1: # 서비스명
    #image: zipdrv/edm60:6.1.0.1 # 이미지, 태그
    build:
      context: ../edm/
      dockerfile: Dockerfile
    ports:
      - "7184:7080"
    expose:
      - "7080"
    env_file:
      - ../edm/edm.postgres.env
    volumes:
      - /docker/service/postEdmHA/data:/app/xedrm60/data
    networks:
      - backend
    depends_on:
      - db
  db:
      image: postgres:13-alpine
      #build:
        #context: ../db/postgres/
        #dockerfile: DockerfileAlpine13
      container_name: postgres13HA-database
      restart: always 
      environment:
        - POSTGRES_PASSWORD=#Inzent@2020
      volumes:
        - postgres13HA:/var/lib/postgresql/data
        - ../db/postgres/script:/docker-entrypoint-initdb.d
      ports:
        - "7181:5432"
      networks:
        - backend
  nginxHA:
    image: nginx
    ports:
      - "7183:80"
    volumes:
      - ../nginx/nginx.conf:/etc/nginx/nginx.conf
    networks:
      - backend

volumes:
  postgres13HA:
    #driver: local
    #driver_opts:
      #type: none
      #device: /docker/db/postgres13/data
      #o: bind
networks:
  backend:
    driver: bridge
